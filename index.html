<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>OniLang Playground</title>

<!-- ğŸ§© CodeMirror -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.15/lib/codemirror.min.css">
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.15/lib/codemirror.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.15/mode/python/python.min.js"></script>

<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: #1e1e1e;
  color: #ddd;
  text-align: center;
  padding: 20px;
}
h1 { color: #f0db4f; }
#editor {
  width: 80%;
  height: 250px;
  margin: auto;
  border: 1px solid #444;
  border-radius: 8px;
  overflow: hidden;
}
button {
  margin-top: 15px;
  padding: 10px 25px;
  font-size: 16px;
  background: #007acc;
  border: none;
  border-radius: 6px;
  color: white;
  cursor: pointer;
}
button:hover { background: #0091ea; }
pre {
  background: #111;
  color: #0f0;
  padding: 15px;
  width: 80%;
  margin: 20px auto;
  border-radius: 8px;
  text-align: left;
  white-space: pre-wrap;
}
</style>
</head>

<body>
<h1>ğŸ§™ OniLang Playground</h1>
<p>æ—¥æœ¬èªã§Pythonã‚’æ›¸ã‘ã‚‹æ–°è¨€èª OniLang</p>

<div id="editor"></div>
<button onclick="execute()">â–¶ å®Ÿè¡Œ</button>
<pre id="output">ï¼ˆPyodide èª­ã¿è¾¼ã¿ä¸­â€¦ï¼‰</pre>

<!-- ğŸ Pyodide -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.26.2/full/pyodide.js"></script>

<script>
let pyodide;
let editor;

// CodeMirror åˆæœŸåŒ–
window.onload = async function() {
  editor = CodeMirror(document.getElementById("editor"), {
    value: 'ç¹°ã‚Šè¿”ã™ i ã§ ç¯„å›²(3):\n    è¨€ã†("ã“ã‚“ã«ã¡ã¯", i)',
    mode: "python",
    theme: "default",
    lineNumbers: true,
    indentUnit: 4,
    tabSize: 4,
  });

  pyodide = await loadPyodide();
  document.getElementById("output").textContent = "âœ… Pyodide loaded!";
};

// OniLang â†’ Python å¤‰æ›
function translateOniLang(code) {
  const dict = {
    "è¨€ã†": "print",
    "èã": "input",
    "ã‚‚ã—": "if",
    "ãã‚Œä»¥å¤–": "else",
    "ç¹°ã‚Šè¿”ã™": "for",
    "ç¯„å›²": "range",
    "å®šç¾©": "def",
    "ã§": "in"
  };
  for (const [jp, py] of Object.entries(dict)) {
    code = code.replaceAll(jp, py);
  }
  return code;
}

// å®Ÿè¡Œ
async function execute() {
  const code = editor.getValue();
  const pyCode = translateOniLang(code);
  const safeCode = JSON.stringify(pyCode);

  const wrapper = [
    "import io, sys",
    "from contextlib import redirect_stdout",
    "buf = io.StringIO()",
    "try:",
    "    with redirect_stdout(buf):",
    `        exec(${safeCode}, {})`,
    "    result = buf.getvalue()",
    "except Exception as e:",
    "    result = 'âš ï¸ ã‚¨ãƒ©ãƒ¼: ' + str(e)",
    "result"
  ].join("\n");

  try {
    const result = await pyodide.runPythonAsync(wrapper);
    document.getElementById("output").textContent = result.trim() || "ï¼ˆå‡ºåŠ›ãªã—ï¼‰";
  } catch (err) {
    document.getElementById("output").textContent = "âš ï¸ å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: " + err;
  }
}
</script>
</body>
</html>
